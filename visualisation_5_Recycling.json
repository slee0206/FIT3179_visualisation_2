{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
    "url": "https://raw.githubusercontent.com/slee0206/FIT3179_visualisation_2/refs/heads/main/clean_waste_recycle_total_recycling.csv"
  },
  "params": [
    {
      "name": "selectedState",
      "value": "SA",
      "bind": {
        "input": "select",
        "options": ["ACT", "NSW", "NT", "Qld", "SA", "Tas", "Vic", "WA"],
        "name": "Select State: "
      }
    }
  ],
  "transform": [
    {"filter": "datum.Jurisdiction == selectedState"},
    {"filter": "datum.Year >= 2010 && datum.Year <= 2020"},
    {
      "window": [{"op": "lag", "field": "Tonnes", "as": "PreviousTonnes"}],
      "sort": [{"field": "Year"}]
    },
    {"calculate": "datum.Tonnes - datum.PreviousTonnes", "as": "Difference"},
    {
      "window": [{"op": "sum", "field": "Difference", "as": "CumulativeSum"}],
      "sort": [{"field": "Year"}]
    },
    {
      "calculate": "datum.Difference > 0 ? 'Increase' : 'Decrease'",
      "as": "ChangeType"
    },
    {
      "window": [{"op": "lead", "field": "Year", "as": "nextYear"}],
      "frame": [null, 1]
    },
    {
      "window": [
        {"op": "lead", "field": "CumulativeSum", "as": "nextCumulativeSum"}
      ],
      "frame": [null, 1]
    }
  ],
  "width": 800,
  "height": 450,
  "encoding": {
    "x": {
      "field": "Year",
      "type": "ordinal",
      "title": "Year",
      "axis": {"labelAngle": 0}
    },
    "y": {
      "field": "CumulativeSum",
      "type": "quantitative",
      "title": "Recycling Tonnes (Cumulative)"
    }
  },
  "layer": [
    {
      "mark": {"type": "bar", "size": 45},
      "encoding": {
        "y2": {"field": "PreviousTonnes"},
        "color": {
          "field": "ChangeType",
          "type": "nominal",
          "scale": {
            "domain": ["Increase", "Decrease"],
            "range": ["#1f77b4", "#d62728"]
          },
          "legend": {"title": "Change Type"}
        },
        "tooltip": [
          {"field": "Year", "type": "ordinal", "title": "Year"},
          {
            "field": "Tonnes",
            "type": "quantitative",
            "title": "Recycling Tonnes"
          },
          {
            "field": "Difference",
            "type": "quantitative",
            "title": "Change in Tonnes"
          },
          {
            "field": "CumulativeSum",
            "type": "quantitative",
            "title": "Cumulative Tonnes"
          }
        ]
      }
    },
    {
      "mark": {
        "type": "rule",
        "color": "#404040",
        "opacity": 1,
        "strokeWidth": 2
      },
      "transform": [{"filter": "datum.nextCumulativeSum != null"}],
      "encoding": {
        "x": {"field": "Year"},
        "x2": {"field": "nextYear"},
        "y": {"field": "CumulativeSum"},
        "y2": {"field": "CumulativeSum"}
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "center",
        "dy": -10,
        "fontWeight": "bold",
        "color": "#404040"
      },
      "encoding": {
        "y": {"field": "CumulativeSum", "type": "quantitative"},
        "text": {
          "field": "Difference",
          "type": "quantitative",
          "format": "+.2f",
          "title": "Difference (Tonnes)"
        }
      }
    }
  ],
  "config": {}
}
